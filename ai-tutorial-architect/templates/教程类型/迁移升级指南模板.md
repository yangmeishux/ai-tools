# 迁移升级指南模板

> 适用于指导读者从旧版本迁移到新版本、或从旧技术栈迁移到新技术栈
> 质量目标：迁移路径清晰、风险可控、回滚方案完备
> Agent 配置：Researcher（调研）+ Practitioner（验证）+ Version-Archivist（版本管理）+ Chief（审核）

---

## 🎭 Agent 协作流程

```
[Chief] 确定迁移范围和目标版本
    ↓
[@researcher] 调研版本差异、破坏性变更、社区迁移经验
    ↓
[@version-archivist] 建立版本兼容性矩阵、标注变更点
    ↓
[@practitioner] 在测试环境演练迁移过程、验证方案可行性
    ↓
[@writer] 撰写迁移步骤、编写代码转换示例
    ↓
[@practitioner] 再次验证所有迁移步骤和脚本
    ↓
[@fact-checker] 验证变更信息的准确性
    ↓
[@editor] 优化迁移流程的表达和结构
    ↓
[Chief] 审核并定稿
```

---

## 📋 模板使用指南

### 适用场景
- ✅ 框架/库的版本升级（如 React 17→18、Vue 2→3）
- ✅ 编程语言版本升级（如 Python 3.10→3.12）
- ✅ 技术栈迁移（如 webpack→Vite、JavaScript→TypeScript）
- ✅ 架构迁移（如单体→微服务、REST→GraphQL）
- ✅ 数据库迁移（如 MySQL→PostgreSQL）

### 不适用场景
- ❌ 简单的配置更新
- ❌ 无破坏性变更的补丁升级
- ❌ 纯概念性内容

### 核心特点
- 🗺️ **路径清晰**：明确的迁移步骤和时间线
- ⚠️ **风险可控**：充分评估和准备风险应对方案
- 🔄 **可回滚**：提供回滚方案以防万一
- ✅ **经过验证**：所有步骤在实际环境中测试通过

---

# [技术名称] 迁移指南：[旧版本] → [新版本]

> 从 [旧版本] 迁移到 [新版本] 的完整指南
> 
> 📊 迁移复杂度：[低/中/高] | ⏱️ 预计时间：[X] 小时 | 👥 建议团队规模：[人数]

---

## 📑 迁移概览

### 版本对比

| 维度 | [旧版本] | [新版本] | 变化 |
|------|----------|----------|------|
| **发布日期** | YYYY-MM-DD | YYYY-MM-DD | - |
| **支持状态** | [维护中/停止维护] | [活跃开发] | - |
| **性能提升** | 基准 | +X% | ⬆️ 提升 |
| **包体积** | X MB | Y MB | ⬇️ 减少 |
| **新特性** | - | [数量] 个 | ➕ 新增 |
| **破坏性变更** | - | [数量] 个 | ⚠️ 注意 |

### 迁移前检查清单

- [ ] 已备份所有代码和数据库
- [ ] 已阅读官方迁移指南
- [ ] 已在测试环境演练迁移
- [ ] 已评估迁移风险和影响范围
- [ ] 已准备好回滚方案
- [ ] 已安排足够的迁移时间
- [ ] 已通知相关团队成员

---

## 一、迁移准备

### 1.1 了解主要变更

#### 🎉 新特性

1. **[特性名称 1]**
   - **说明**：[描述]
   - **价值**：[带来的好处]
   - **文档**：[链接]

2. **[特性名称 2]**
   - **说明**：[描述]
   - **价值**：[带来的好处]

#### ⚠️ 破坏性变更

1. **[变更 1]**
   - **影响范围**：[哪些代码受影响]
   - **迁移成本**：[低/中/高]
   - **自动化支持**：✅/❌ 是否支持自动迁移

2. **[变更 2]**
   - **影响范围**：[描述]
   - **迁移成本**：[低/中/高]

#### 🐛 已知问题

| 问题 | 影响版本 | 状态 | 解决方案 |
|------|----------|------|----------|
| [问题1] | vX.Y.Z | 已修复 | 升级到 vX.Y.Z+1 |
| [问题2] | vX.Y.Z | 已知 | [workaround] |

### 1.2 环境要求检查

#### 系统要求对比

| 要求项 | [旧版本] | [新版本] | 检查结果 |
|--------|----------|----------|----------|
| 最低 Node.js 版本 | v14 | v16 | [ ] 检查 |
| 最低 Python 版本 | 3.8 | 3.10 | [ ] 检查 |
| 内存要求 | 2GB | 4GB | [ ] 检查 |
| 浏览器支持 | IE11+ | Chrome 90+ | [ ] 检查 |

#### 依赖兼容性

```bash
# 检查当前依赖版本
[检查命令]

# 预期输出示例
[依赖1] v1.2.3 ✅ 兼容
[依赖2] v2.0.0 ⚠️ 需要升级到 v3.x
[依赖3] v1.0.0 ❌ 不再支持，需要替换
```

---

## 二、迁移方案选择

### 2.1 迁移策略对比

| 策略 | 描述 | 适用场景 | 风险 | 时间 |
|------|------|----------|------|------|
| **大爆炸式** | 一次性全部升级 | 小型项目 | 高 | 短 |
| **渐进式** | 部分模块逐步升级 | 大型项目 | 低 | 长 |
| **并行运行** | 新旧版本同时运行 | 关键业务 | 最低 | 最长 |
| **分支迁移** | 功能分支独立迁移 | 团队协作 | 中 | 中 |

### 2.2 推荐方案

**本次迁移采用：[策略名称]**

**理由**：
- [理由 1]
- [理由 2]
- [理由 3]

**整体时间线**：
```
第 1 周：准备阶段
    ├─ 环境搭建
    ├─ 依赖梳理
    └─ 团队培训

第 2-3 周：迁移实施
    ├─ 代码迁移
    ├─ 配置更新
    └─ 测试验证

第 4 周：上线部署
    ├─ 生产环境部署
    ├─ 监控观察
    └─ 问题修复
```

---

## 三、迁移实施步骤

### 3.1 步骤 1：备份与准备

#### 创建备份

```bash
# 1. 备份代码仓库
git tag -a pre-migration -m "Migration backup before upgrading to [新版本]"
git push origin pre-migration

# 2. 备份配置文件
cp config/config.yaml config/config.yaml.backup

# 3. 备份数据库（如需要）
[数据库备份命令]
```

#### 创建迁移分支

```bash
# 创建专门的迁移分支
git checkout -b migration/[旧版本]-to-[新版本]
```

### 3.2 步骤 2：更新依赖

#### 安装新版本

```bash
# 使用包管理器升级
[升级命令示例]

# 示例：npm
npm install [package]@[新版本]

# 示例：pip
pip install [package]==[新版本]

# 示例：go
go get [package]@[新版本]
```

#### 解决依赖冲突

```bash
# 检查依赖树
[检查命令]

# 如果发现冲突，手动指定兼容版本
[解决命令]
```

### 3.3 步骤 3：代码迁移

#### 自动化迁移工具

```bash
# 运行官方迁移工具（如有）
[迁移工具命令]

# 示例：React Codemod
npx @react/codemod upgrade [path]

# 示例：TypeScript 迁移
npx ts-migrate-full [path]
```

> **[@practitioner] 验证**：此迁移工具已在 [环境] 下测试

#### 手动迁移清单

**变更 1：[变更描述]**

```javascript
// ❌ 旧版本写法
[旧代码示例]

// ✅ 新版本写法
[新代码示例]
```

**批量替换脚本**（可选）：
```bash
# 使用 sed 批量替换
sed -i 's/oldPattern/newPattern/g' [文件路径]

# 或使用 codemod
[转换脚本]
```

**变更 2：[变更描述]**

```javascript
// ❌ 旧版本写法
[旧代码示例]

// ✅ 新版本写法
[新代码示例]
```

#### 配置文件更新

**[配置文件 1]** - `[文件路径]`

```yaml
# 旧配置
[旧配置内容]

# 新配置
[新配置内容]
```

**变更说明**：
- [配置项 A]：从 `[旧值]` 改为 `[新值]`，因为 [原因]
- [配置项 B]：新增，用于 [用途]
- [配置项 C]：已弃用，使用 [替代方案]

### 3.4 步骤 4：测试验证

#### 自动化测试

```bash
# 运行单元测试
[命令]

# 预期结果：所有测试通过
```

#### 手动测试清单

- [ ] 核心功能测试：[功能描述]
- [ ] 边界条件测试：[场景描述]
- [ ] 性能基准测试：[指标对比]
- [ ] 兼容性测试：[测试环境]

#### 验证脚本

```bash
#!/bin/bash
# migration-verify.sh

echo "=== 迁移验证 ==="

# 1. 检查版本
echo "检查版本..."
[检查命令]

# 2. 运行测试
echo "运行测试..."
[测试命令]

# 3. 检查构建
echo "检查构建..."
[构建命令]

echo "=== 验证完成 ==="
```

> **[@practitioner] 验证**：以上脚本已在 [环境] 下测试通过

### 3.5 步骤 5：部署上线

#### 生产环境部署

```bash
# 1. 合并迁移分支到主分支
git checkout main
git merge migration/[旧版本]-to-[新版本]

# 2. 创建发布标签
git tag -a v[新版本] -m "Release v[新版本]"
git push origin v[新版本]

# 3. 部署到生产环境
[部署命令]
```

#### 部署后检查

- [ ] 服务正常启动
- [ ] 健康检查通过
- [ ] 关键业务流程正常
- [ ] 监控指标正常
- [ ] 日志无异常

---

## 四、常见问题与解决方案

### 4.1 迁移过程中的问题

**问题 1：[问题描述]**

**现象**：
```
[错误信息]
```

**原因**：[原因分析]

**解决方案**：
```bash
[解决命令]
```

> **[@practitioner] 经验**：此问题在 [场景] 下最常见

**问题 2：[问题描述]**

[同上结构]

### 4.2 上线后的问题

**问题 1：性能下降**

**排查步骤**：
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

**解决方案**：
```javascript
// 优化方案
[代码示例]
```

---

## 五、回滚方案

### 5.1 何时需要回滚

- 严重功能故障，无法在 [X] 小时内修复
- 性能下降超过 [X]%
- 数据完整性问题
- 安全漏洞

### 5.2 回滚步骤

```bash
# 1. 停止当前服务
[停止命令]

# 2. 恢复数据库（如需要）
[恢复命令]

# 3. 回滚代码
git checkout pre-migration

# 4. 恢复配置文件
cp config/config.yaml.backup config/config.yaml

# 5. 重新安装旧版本依赖
[安装命令]

# 6. 重启服务
[启动命令]

# 7. 验证回滚成功
[验证命令]
```

### 5.3 回滚检查清单

- [ ] 服务已停止
- [ ] 数据库已恢复
- [ ] 代码已回滚到旧版本
- [ ] 配置已恢复
- [ ] 依赖已降级
- [ ] 服务已重启
- [ ] 功能验证通过

---

## 六、迁移后优化

### 6.1 利用新特性

**特性 1：[特性名称]**

```javascript
// 迁移后可以使用的优化写法
[新特性代码示例]

// 收益：[性能提升/代码简化等]
```

**特性 2：[特性名称]**

[同上结构]

### 6.2 清理遗留代码

```bash
# 1. 查找遗留的旧版本代码模式
[搜索命令]

# 2. 逐步替换
[替换步骤]
```

---

## 七、团队协作指南

### 7.1 代码审查要点

审查迁移代码时，重点关注：
- [ ] 是否使用了已弃用的 API
- [ ] 错误处理是否适配新版本
- [ ] 类型定义是否正确更新
- [ ] 测试用例是否覆盖变更

### 7.2 沟通模板

**迁移通知邮件模板**：
```
主题：[技术名称] 迁移通知：[旧版本] → [新版本]

各位同事：

我们计划于 [日期] 将 [技术名称] 从 [旧版本] 迁移到 [新版本]。

影响范围：
- [影响模块 1]
- [影响模块 2]

时间安排：
- 迁移日期：[日期]
- 预计时长：[时长]
- 回滚窗口：[时长]

请大家在迁移期间：
- 暂停向主分支提交代码
- 关注迁移通知群
- 有问题及时联系 [负责人]

谢谢配合！
[负责人]
[日期]
```

---

## 八、参考资源

### 官方资源

- [官方迁移指南](链接)
- [版本发布说明](链接)
- [API 变更文档](链接)
- [迁移工具仓库](链接)

### 社区资源

- [社区迁移经验分享](链接)
- [常见问题和解决方案](链接)
- [迁移成本计算器](链接)

### 相关工具

- [迁移工具 1]：[用途说明]
- [迁移工具 2]：[用途说明]

---

## ✅ 迁移指南检查清单

> **[@practitioner] 验证项**：

- [ ] 所有迁移步骤经过实际测试
- [ ] 自动化迁移脚本可运行
- [ ] 回滚方案经过验证
- [ ] 常见问题有解决方案
- [ ] 验证脚本可用

> **[@fact-checker] 验证项**：

- [ ] 所有版本信息准确
- [ ] 变更信息来自官方文档
- [ ] 兼容性信息正确

> **[@editor] 审核项**：

- [ ] 迁移步骤逻辑清晰
- [ ] 代码示例正确
- [ ] 时间线合理

---

*基于 AI Tutorial Architect 迁移升级指南模板 v1.0.0*
*最后更新：2026-01-28*
